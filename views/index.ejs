<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SnapVerse | Share Your Moments</title>
  <link href="/css/style.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
</head>

<body>

  <!-- Navbar -->
  <nav class="navbar">
    <div class="nav-left">
      <a href="/" class="navbar-brand">SnapVerse</a>
    </div>

    <div class="nav-links">
      <% if (!user) { %>
        <!-- Clean Nav for Guest (Match Screenshot - No Home Link) -->
        <a href="/login" class="nav-item">Login</a>
        <a href="/signup" class="btn btn-primary" style="padding: 10px 24px;">Sign Up</a>
        <% } else { %>
          <a href="/" class="nav-item active-link">Home</a>
          <span class="nav-item desktop-only">Hi, <%= user.username %></span>
          <% if (user.role !=="consumer" ) { %>
            <a href="/upload" class="nav-item upload-btn-nav">
              <i class="bi bi-cloud-upload-fill" style="color: white; margin-right: 5px;"></i> Upload
            </a>
            <% } %>
              <a href="/logout" class="nav-item logout-link" title="Logout">
                <i class="bi bi-box-arrow-right" style="font-size: 1.2rem;"></i>
              </a>
              <% } %>
    </div>
  </nav>

  <!-- HERO SECTION / LANDING PAGE logic -->
  <!-- Case 1: Guest User (Not Logged In) -> Show Landing Hero ONLY -->
  <% if (!user) { %>
    <div class="landing-hero">
      <div class="landing-content">
        <h1 class="animate-text">Visual Stories, <br><span class="highlight">Unleashed.</span></h1>
        <p class="subtitle">
          Join the next generation of visual creators. SnapVerse is the canvas for your imagination,
          powered by the cloud and built for community.
        </p>
        <div class="cta-buttons">
          <a href="/signup" class="btn btn-primary btn-lg">Start Creating</a>
          <a href="/login" class="btn btn-secondary btn-lg">Member Login</a>
        </div>
      </div>
    </div>

    <!-- Platform Features (New Layout: Cards Grid) -->
    <div class="landing-features" style="gap: 25px;">
      <h2 class="features-title" style="grid-column: 1/-1; margin-bottom: 30px;">Why SnapVerse?</h2>

      <!-- Creator Mode -->
      <div class="feature-item card-style">
        <div class="icon-box">
          <i class="bi bi-camera-reels-fill" style="margin: 0;"></i>
        </div>
        <div class="text-box">
          <h3>For Storytellers</h3>
          <p>A dedicated space to clear the noise and focus on your visual narrative.</p>
        </div>
      </div>

      <!-- Discover & Search -->
      <div class="feature-item card-style">
        <div class="icon-box">
          <i class="bi bi-compass-fill" style="margin: 0;"></i>
        </div>
        <div class="text-box">
          <h3>Endless Exploration</h3>
          <p>Dive deep into global trends and discover hidden gems instantly.</p>
        </div>
      </div>

      <!-- Cloud Native -->
      <div class="feature-item card-style">
        <div class="icon-box">
          <i class="bi bi-infinity" style="margin: 0;"></i>
        </div>
        <div class="text-box">
          <h3>Limitless Scale</h3>
          <p>Backed by enterprise-grade Azure infrastructure. We grow as you grow.</p>
        </div>
      </div>
    </div>

    <!-- Case 2: Logged In User -> Show Feed or Empty State -->
    <% } else { %>

      <!-- Empty Feed State -->
      <% if (images.length===0) { %>
        <div class="container mt-5 text-center empty-feed-state">
          <div class="card p-5"
            style="max-width: 600px; margin: 0 auto; border: none; background: #fff; box-shadow: var(--card-shadow);">
            <div style="font-size: 3rem; margin-bottom: 20px;">✨</div>
            <h2 style="margin-bottom: 10px; color: var(--text-color);">Hello, <%= user.username %>
            </h2>
            <p style="color: var(--text-muted);">Your canvas is blank. Time to paint it.</p>

            <% if (user.role !=='consumer' ) { %>
              <div class="mt-4">
                <a href="/upload" class="btn btn-primary">
                  Share a Moment
                </a>
              </div>
              <% } %>
          </div>
        </div>

        <!-- Main Feed (Only for Logged In Users) -->
        <% } else { %>
          <div class="container feed-container">
            <div class="feed-header text-center mb-4">
              <h2 class="feed-title">Latest Moments</h2>
            </div>

            <div class="feed-grid">
              <% images.slice().reverse().forEach((image, index)=> { %>
                <% const realIndex=images.length - 1 - index; %>

                  <div class="post-card">
                    <!-- Left: Image -->
                    <div class="image-wrapper">
                      <img src="<%= image.path %>" class="post-image" alt="Post by <%= image.user %>">
                    </div>

                    <!-- Right: Content -->
                    <div class="post-content-wrapper">
                      <div class="post-header">
                        <div class="user-avatar-placeholder">
                          <%= image.user.substring(0,2).toUpperCase() %>
                        </div>
                        <div class="user-info">
                          <div class="user-name">
                            <%= image.user %>
                          </div>
                        </div>
                      </div>

                      <div class="post-footer">
                        <div class="caption-area">
                          <span class="user-name-inline">
                            <%= image.user %>
                          </span>
                          <span class="caption-text">
                            <%= image.caption %>
                          </span>
                        </div>

                        <div class="comments-section scrollbar-hidden">
                          <% if (image.comments.length> 0) { %>
                            <% image.comments.slice(-3).forEach(c=> { %>
                              <div class="comment-row">
                                <strong style="font-weight: 600;">
                                  <%= c.user %>
                                </strong>
                                <%= c.text %>
                              </div>
                              <% }) %>
                                <% } %>
                        </div>

                        <div class="post-actions">
                          <form action="/like/<%= realIndex %>" method="POST" style="display:inline;">
                            <button class="action-btn like-btn">
                              <i class="bi bi-heart-fill" style="color: #ed4956;"></i>
                              <span>
                                <%= image.likes %>
                              </span>
                            </button>
                          </form>
                        </div>

                        <% if (user) { %>
                          <form action="/comment/<%= realIndex %>" method="POST" class="comment-input-area mt-2"
                            style="padding-top: 10px;">
                            <input type="text" name="comment" class="comment-input" placeholder="Add a comment..."
                              required />
                            <button type="submit" class="post-btn">Post</button>
                          </form>
                          <% } %>
                      </div>
                    </div>
                  </div>
                  <% }) %>
            </div>
          </div>
          <% } %>
            <% } %>

              <!-- LIGHTBOX MODAL -->
              <div id="imageModal" class="lightbox-modal">
                <span class="close-modal">&times;</span>
                <img class="modal-content" id="fullImage">
                <div id="captionText"></div>
              </div>

              <script>
                const modal = document.getElementById('imageModal');
                const modalImg = document.getElementById("fullImage");
                const captionText = document.getElementById("captionText");
                const span = document.getElementsByClassName("close-modal")[0];

                // Add click event to all post images
                const images = document.querySelectorAll('.post-image');
                images.forEach(img => {
                  img.onclick = function () {
                    modal.style.flex = "flex";
                    modal.style.display = "flex"; // Force flex
                    modalImg.src = this.src;
                    captionText.innerHTML = this.alt;
                  }
                });

                span.onclick = function () {
                  modal.style.display = "none";
                }

                modal.onclick = function (e) {
                  if (e.target === modal) {
                    modal.style.display = "none";
                  }
                }
              </script>

              <footer class="main-footer">
                <p>© 2026 SnapVerse - COM769 Coursework Project</p>
                <p style="font-size: 0.8rem; opacity: 0.6;">Built with Node.js & Azure</p>
              </footer>

</body>

</html>